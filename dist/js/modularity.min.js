var Modularity=Modularity||{};!function(t){t('input[type="checkbox"].sidebar-area-activator').on("click",function(i){var o=t(this).is(":checked"),e=t(this).attr("value");i.shiftKey&&(o?t('input.sidebar-area-activator[type="checkbox"][value="'+e+'"]').attr("checked",!0):t('input.sidebar-area-activator[type="checkbox"][value="'+e+'"]').attr("checked",!1))})}(jQuery),function(t){t("#modularity-options #publish").on("click",function(){t(this).siblings(".spinner").css("visibility","visible")}),t('a.wp-first-item[href="admin.php?page=modularity"]').parent("li").remove(),t("#modularity-tabs a").on("click",function(i){return wp.autosave&&(t(window).unbind(),wp.autosave.server.triggerSave(),t(document).ajaxComplete(function(){return!0})),!0})}(jQuery),jQuery(document).ready(function(t){if(t("#modularity-mb-modules").length){var i=t("#modularity-mb-modules").offset();t(document).scroll(function(){t(window).scrollTop()+50>i.top&&!t("#modularity-mb-modules").hasClass("is-fixed")?t("#modularity-mb-modules").addClass("is-fixed"):t(window).scrollTop()+50<i.top&&t("#modularity-mb-modules").hasClass("is-fixed")&&t("#modularity-mb-modules").removeClass("is-fixed")})}t(".modularity-edit-module a").on("click",function(i){i.preventDefault(),Modularity.Editor.Thickbox.postAction="edit-inline-not-saved",Modularity.Prompt.Modal.open(t(i.target).closest("a").attr("href"))})}),Modularity=Modularity||{},Modularity.Editor=Modularity.Editor||{},Modularity.Editor.Autosave=function(t){function i(){t(function(){}.bind(this))}return i.prototype.save=function(i){t("#modularity-options #publishing-action .spinner").css("visibility","visible");var o=t(i).serializeObject();o.id=modularity_post_id,o.action="save_modules",t.post(ajaxurl,o,function(i){t("#modularity-options #publishing-action .spinner").css("visibility","hidden")})},new i}(jQuery),Modularity=Modularity||{},Modularity.Editor=Modularity.Editor||{},Modularity.Editor.DragAndDrop=function(t){function i(){t(function(){"undefined"!=typeof pagenow&&"admin_page_modularity-editor"==pagenow&&this.init()}.bind(this))}return i.prototype.init=function(){this.setupDraggable(),this.setupDroppable(),this.setupSortable()},i.prototype.setupSortable=function(){t(".modularity-js-sortable").sortable({handle:".modularity-sortable-handle",connectWith:".modularity-js-sortable",placeholder:"ui-sortable-placeholder",stop:function(i,o){var e=o.item.parents("ul").data("area-id");o.item.find('input[name^="modularity_modules"]').each(function(i,o){var a=t(this).attr("name").replace(/\[(.*?)\]/i,"["+e+"]");t(this).attr("name",a)})}}).bind(this)},i.prototype.setupDraggable=function(){t(".modularity-js-draggable").draggable({appendTo:"body",containment:"document",scroll:!1,helper:"clone",revert:"invalid",revertDuration:200,start:function(t,i){try{var o=jQuery(this).attr("data-sidebar-incompability");o=JSON.parse(o),o&&"object"==typeof o&&jQuery(".modularity-sidebar-area").each(function(t,i){o.includes(jQuery(this).attr("data-area-id"))?jQuery(this).parent().parent().addClass("modularity-incompatible-area"):jQuery(this).parent().parent().removeClass("modularity-incompatible-area")})}catch(e){console.log("Incompability information not defined - "+e)}},stop:function(t,i){jQuery("[id^=modularity-mb-]").removeClass("modularity-incompatible-area")}})},i.prototype.setupDroppable=function(){t(".modularity-js-droppable").droppable({accept:".modularity-js-draggable",hoverClass:"modularity-state-droppable",drop:function(t,i){this.appendModule(t,i)}.bind(this)}).bind(this)},i.prototype.appendModule=function(t,i){var o=i.draggable,e=o.find(".modularity-module-name").text(),a=o.data("module-id");Modularity.Editor.Module.addModule(t.target,a,e)},new i}(jQuery),Modularity=Modularity||{},Modularity.Editor=Modularity.Editor||{},Modularity.Editor.Module=function(t){function i(){t(function(){"undefined"!=typeof pagenow&&"admin_page_modularity-editor"==pagenow&&(this.handleEvents(),this.loadModules(modularity_post_id))}.bind(this))}var o={is_thickbox:!0},e=!1;return i.prototype.loadModules=function(i){var o={action:"get_post_modules",id:i};t.post(ajaxurl,o,function(i){t.each(i,function(i,o){var e=t('.modularity-sidebar-area[data-area-id="'+i+'"]');t.each(o.modules,function(t,i){"true"==i.hidden&&(i.hidden=!0),this.addModule(e,i.post_type,i.post_type_name,i.post_title,i.ID,i.hidden,i.columnWidth,i.isDeprecated)}.bind(this)),e.removeClass("modularity-spinner")}.bind(this)),this.initCompleted=!0,t(".modularity-sidebar-area").removeClass("modularity-spinner")}.bind(this),"json")},i.prototype.isEditingModule=function(){return e},i.prototype.getThickBoxUrl=function(i,e){var a="",d={};switch(i){case"add":a="post-new.php";break;case"edit":a="post.php"}return"number"==typeof e.postId&&(d.post=e.postId,d.action="edit"),"string"==typeof e.postType&&(d.post_type=e.postType),admin_url+a+"?"+t.param(d)+"&"+t.param(o)},i.prototype.getImportUrl=function(i){var e="edit.php",a={};return a.post_type=i.postType,admin_url+e+"?"+t.param(a)+"&"+t.param(o)},i.prototype.addModule=function(i,o,e,a,d,r,n,l){a="undefined"!=typeof a?": "+a:"",d="undefined"!=typeof d?d:"",n="undefined"!=typeof n?n:"",deprecated=l===!0?'<span class="modularity-deprecated" style="color:#ff0000;">('+modularityAdminLanguage.deprecated+")</span>":"";var u=this.getThickBoxUrl("add",{postType:o});Modularity.Editor.Thickbox.postAction="add",d&&(u=this.getThickBoxUrl("edit",{postId:d}),Modularity.Editor.Thickbox.postAction="edit");var s=this.getImportUrl({postType:o}),p="";r===!0&&(p="checked");var c=t(i).data("area-id"),m=Modularity.Helpers.uuid(),y='<li id="post-'+d+'" data-module-id="'+o+'" data-module-stored-width="'+n+'">                <span class="modularity-line-wrapper">                    <span class="modularity-sortable-handle"></span>                    <span class="modularity-module-name">                        '+e+"                        "+deprecated+'                        <span class="modularity-module-title">'+a+'</span>                        <label class="modularity-module-hide">                            <input type="hidden" name="modularity_modules['+c+"]["+m+'][hidden]" value="false" />                            <input type="checkbox" name="modularity_modules['+c+"]["+m+'][hidden]" value="true" '+p+" />                            "+modularityAdminLanguage.langhide+'                        </label>                    </span>                    <span class="modularity-module-columns">                        <label>'+modularityAdminLanguage.width+':</label>                        <select name="modularity_modules['+c+"]["+m+'][columnWidth]">                            '+modularityAdminLanguage.widthOptions+'                        </select>                    </span>                    <span class="modularity-module-actions">                        <a href="'+u+'" data-modularity-modal class="modularity-js-thickbox-open"><span>'+modularityAdminLanguage.langedit+'</span></a>                        <a href="'+s+'" class="modularity-js-thickbox-import"><span>'+modularityAdminLanguage.langimport+'</span></a>                        <a href="#remove" class="modularity-module-remove"><span>'+modularityAdminLanguage.langremove+'</span></a>                    </span>                    <input type="hidden" name="modularity_modules['+c+"]["+m+'][postid]" class="modularity-js-module-id" value="'+d+'" required>                </span>            </li>';t(i).append(y),t(".modularity-sidebar-area > li").each(function(i,o){t(".modularity-module-columns select",t(o)).val(t(o).attr("data-module-stored-width"))}),t(".modularity-js-sortable").sortable("refresh")},i.prototype.updateModule=function(t,i){t.find("a.modularity-js-thickbox-open").attr("href",this.getThickBoxUrl("edit",{postId:i.post_id})),t.find("input.modularity-js-module-id").val(i.post_id).change(),t.find(".modularity-module-title").text(": "+i.title)},i.prototype.removeModule=function(t){confirm(modularityAdminLanguage.actionRemove)&&t.remove()},i.prototype.handleEvents=function(){t(document).on("click",".modularity-module-remove",function(i){i.preventDefault();var o=t(i.target).closest("li");this.removeModule(o)}.bind(this)),t(document).on("click",".modularity-js-thickbox-import",function(i){i.preventDefault();t(i.target).closest("a");e=t(i.target).closest("li"),Modularity.Editor.Thickbox.postAction="import",Modularity.Prompt.Modal.open(t(i.target).closest("a").attr("href"))}),t(document).on("click",".modularity-js-thickbox-open",function(i){i.preventDefault();var o=t(i.target).closest("a");o.attr("href").indexOf("post.php")>-1&&(Modularity.Editor.Thickbox.postAction="edit"),e=t(i.target).closest("li"),Modularity.Prompt.Modal.open(t(i.target).closest("a").attr("href"))}.bind(this))},new i}(jQuery),Modularity=Modularity||{},Modularity.Editor=Modularity.Editor||{},Modularity.Editor.Thickbox=function(t){function i(){}return i.prototype.modulePostCreated=function(i){Modularity.Prompt.Modal.close();var o=Modularity.Editor.Module.isEditingModule(),e={action:"get_post",id:i};t.post(ajaxurl,e,function(t){var i={post_id:t.ID,title:t.post_title};Modularity.Editor.Module.updateModule(o,i),Modularity.Editor.Autosave.save("form")},"json")},new i}(jQuery),Modularity=Modularity||{},Modularity.Editor=Modularity.Editor||{},Modularity.Editor.Validate=function(t){function i(){this.handleEvents()}var o=!1,e="validation-error";return i.prototype.run=function(){o=!1,this.checkRequired()},i.prototype.checkRequired=function(){var i=t("[required]");i.removeClass(e),i.each(function(i,a){0===t(a).val().length&&(t(a).parents("li").addClass(e),t(a).one("change",function(i){t(i.target).parents("li").removeClass(e)}),o=!0)}.bind(this))},i.prototype.handleEvents=function(){t(document).on("click","#modularity-mb-editor-publish #publish",function(i){return this.run(),!o||(t("#modularity-mb-editor-publish .spinner").css("visibility","hidden"),!1)}.bind(this))},new i}(jQuery),Modularity=Modularity||{},Modularity.Helpers=Modularity.Helpers||{},Modularity.Helpers=function(t){function i(){t(function(){}.bind(this))}return i.prototype.uuid=function(t){return Math.random().toString(36).substr(2,9)},new i}(jQuery),jQuery.fn.serializeObject=function(){var t={},i=this.serializeArray();return jQuery.each(i,function(){void 0!==t[this.name]?(t[this.name].push||(t[this.name]=[t[this.name]]),t[this.name].push(this.value||"")):t[this.name]=this.value||""}),t},Modularity=Modularity||{},Modularity.Helpers=Modularity.Helpers||{},Modularity.Helpers.Widget=function(t){function i(){t(function(){t(document).on("click",".modularity-js-thickbox-widget-import-widget",function(i){i.preventDefault(),o=t(i.target).parents(".widget-inside");var e=Modularity.Editor.Module.getImportUrl({postType:t(i.target).parents(".widget-inside").find(".modularity-widget-module-type select").val()});Modularity.Editor.Module.editingModule=t(i.target).closest(".widget-inside"),Modularity.Editor.Thickbox.postAction="import-widget",Modularity.Prompt.Modal.open(e)}),t(document).on("click",".modularity-js-thickbox-open-widget",function(i){i.preventDefault();var o=t(i.target).closest("a");o.attr("href").indexOf("post.php")>-1&&(Modularity.Editor.Thickbox.postAction="edit"),editingModule=t(i.target).closest("li"),Modularity.Prompt.Modal.open(t(i.target).closest("a").attr("href"))}.bind(this))}.bind(this))}var o=!1;return i.prototype.isEditingWidget=function(){return o},i.prototype.updateWidget=function(i,o){t(i).find(".modularity-widget-module-id-span").html(o.post_id),t(i).find(".modularity-widget-module-id").val(o.post_id),t(i).find(".modularity-widget-module-edit").attr("href","post.php?post="+o.post_id+"&action=edit&is_thickbox=true").removeClass("hidden"),t(i).find(".modularity-widget-module-title-span").html(o.title),t(i).find(".modularity-widget-module-title").val(o.title)},new i}(jQuery),Modularity=Modularity||{},Modularity.Prompt=Modularity.Prompt||{},Modularity.Prompt.Modal=function(t){function i(){this.handleEvents()}var o=!1;return i.prototype.open=function(i){t("body").addClass("modularity-modal-open").append('            <div id="modularity-modal">                <div class="modularity-modal-wrapper">                    <button class="modularity-modal-close" data-modularity-modal-action="close">&times; '+modularityAdminLanguage.close+'</button>                    <div class="modularity-modal-spinner-container" id="modularity-iframe-loader"><span class="modularity-modal-spinner"></span></div>                    <iframe class="modularity-modal-iframe" src="'+i+'" frameborder="0" onload="document.getElementById(\'modularity-iframe-loader\').style.display=\'none\';" allowtransparency></iframe>                </div>            </div>        '),o=!0},i.prototype.close=function(){t("body").removeClass("modularity-modal-open"),t("#modularity-modal").remove(),o=!1},i.prototype.handleEvents=function(){t(document).on("click",'[data-modularity-modal-action="close"]',function(t){t.preventDefault(),this.close()}.bind(this))},new i}(jQuery);